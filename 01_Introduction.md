# Introduction

**WHEN I WAS** 10 years old, one of my teachers sat me down in front of a computer at school. Now, this isn’t what you think. I wasn’t about to be inducted into the mysteries of computer programming, even though it was a BBC Micro (the most programmable and arguably the most architecturally sophisticated of the British 8-bit microcomputers, on which I would subsequently cut my teeth in BASIC and assembly language). Instead, I was faced with a half-hour barrage of multiple choice questions about my academic interests, hobbies and ambitions, after which the miraculous machine spat out a diagnosis of my ideal future career: microelectronic chip designer.

> **当我 10 岁时**，我的一位老师将我坐在学校的计算机前。现在，这不是您的想法。尽管它是 BBC 的微型，但我并不是要入选计算机编程的奥秘(这是英国 8 位微型计算机中最精致的最精致的，我随后会在基本的基本上切出我的牙齿和汇编语言)。取而代之的是，我面临着关于我的学术兴趣，爱好和野心的半小时多项选择问题，此后，奇迹般的机器吐出了我理想的未来职业的诊断：微电子芯片设计师。

This was a bit of a puzzler, not least because what I really wanted to be was a computer game programmer (okay, okay, astronaut) and there was nobody in my immediate environment who had any idea what a 10-year-old should do to set him on the path to the sunlit uplands of microelectronic chip design. Over the next few years, I studied a _lot_ of maths and science at school, learned to program (games) at home, first on the BBC Micro and then the Commodore Amiga, and made repeated, not particularly successful, forays into electronics. As it turned out, and more by luck than judgment, I’d happened on a plausible road to my destination, but it wasn’t until I arrived at Cambridge at the age of 18 that I started to figure out where the gaps were in my understanding.

> 这有点令人费解，尤其是因为我真正想成为一名计算机游戏程序员(好吧，好吧，宇航员)，而在我身边的环境中没有人知道一个 10 岁的孩子应该做什么 让他踏上通往微电子芯片设计阳光普照高地的道路。在接下来的几年里，我在学校学习了 _很多_ 数学和科学，在家学习了编程(游戏)，先是在 BBC Micro，然后是 Commodore Amiga，并多次涉足电子领域，但并不是特别成功。事实证明，更多的是运气而不是判断，我碰巧走上了通往目的地的合理道路，但直到我 18 岁到达剑桥，我才开始弄清楚差距在哪里 我的理解。

## Cambridge

Cambridge occupies a special place in the history of computer science, and particularly in the history of practical or applied computing. In the late 1930s, the young Cambridge academic Alan Turing demonstrated that the halting problem (the question `Will this computer program ever terminate, or halt?` ) was not computable; in essence, you can’t write a computer program that will analyse another arbitrary computer program and determine if it will halt. At the same time, working independently, Alonzo Church proved the same result, which now shares their names: the Church-Turing thesis. But it is telling that while Church took a purely mathematical approach to his proof, based on recursive functions, Turing’s proof cast computation in terms of sequential operations performed by what we now know as _Turing machines_: simple gadgets that walk up and down an infinite tape, reading symbols, changing their internal state and direction of travel in response, and writing new symbols. While most such machines are specialised to a single purpose, Turing introduced the concept of the _universal_ machine, which could be configured via commands written on the tape to emulate the action of _any_ other special-purpose machine. This was the first appearance of a now commonplace idea: the general-purpose programmable computer.

> 剑桥在计算机科学史上占有特殊的地位，尤其是在实用或应用计算的历史上。在 1930 年代后期，年轻的剑桥学者艾伦图灵证明了停止问题( `这个计算机程序会终止或停止吗？` 的问题)是不可计算的；**从本质上讲，您不能编写一个计算机程序来分析另一个任意计算机程序并确定它是否会停止。** 与此同时，Alonzo Church 独立工作证明了相同的结果，现在与他们同名：Church-Turing 论题。但很明显，虽然 Church 基于递归函数采用纯数学方法来证明他的证明，但图灵的证明是根据我们现在所知的 _图灵机_ 执行的顺序操作来进行计算的：在无限磁带上走来走去的简单小工具 ，读取符号，改变它们的内部状态和响应的行进方向，并写出新的符号。虽然大多数此类机器专门用于单一用途，但图灵引入了 `通用` 机器的概念，可以通过写在磁带上的命令对其进行配置，以模拟 `任何` 其他专用机器的操作。这是现在司空见惯的想法的首次出现：通用可编程计算机。

After the outbreak of the Second World War, Turing would go on to play a central role in the Allied code-breaking effort at Bletchley Park, where he was involved (as a member of a team—don’t believe everything you see at the movies) in the development of a number of pieces of special-purpose hardware, including the electromechanical _bombe_, which automated the process of breaking the German Enigma cipher. None of these machines used the specific `finite state automaton plus infinite tape` architecture of Turing’s original thought experiment; this turned out to be better suited to mathematical analysis than to actual implementation. And not even the purely electronic Colossus—which did to the formidably sophisticated Lorentz stream cipher what the bombe had done to Enigma—crossed the line into general-purpose programmability. Nonetheless, the experience of developing large-scale electronic systems for code-breaking, radar and gunnery, and of implementing digital logic circuits using thermionic valves, would prove transformative for a generation of academic engineers as they returned to civilian life.

> 第二次世界大战爆发之后，图灵将继续在布莱奇利公园(Bletchley Park)的盟军破坏代码努力中扮演核心角色，他参与了他的参与(作为团队的成员 - 不相信您在电影)在开发许多特殊用途硬件的过程中，包括机电 _bombe_，它们使破坏了德国谜语密码的过程是自动化的。这些机器均未使用图灵原始思想实验的特定 `有限状态自动机加无限磁带` 架构；事实证明，这比实际实施更适合数学分析。甚至没有纯粹的电子巨像(对 Bombe 对 Enigma 所做的一切所做的事情都如此精致的 Lorentz 溪流密码，也没有做到这一点。尽管如此，开发用于破坏代码，雷达和枪支的大型电子系统的经验以及使用热阀实施数字逻辑电路的经验将证明是对一代学术工程师恢复平民生活的变革性。

One group of these engineers, under Maurice Wilkes at the University of Cambridge’s Mathematical Laboratory, set about building what would become the Electronic Delay Storage Automatic Calculator, or EDSAC. When it first became operational in 1949, it boasted a 500kHz clock speed, 32 mercury delay lines in two temperature-controlled water baths for a total of 2 kilobytes of volatile storage. Programs and data could be read from, and written to, paper tape. Many institutions in the U.S. and UK can advance narrow claims to having produced the first general-purpose digital computer, for a particular value of `first` . Claims have been made that EDSAC was the first computer to see widespread use outside the team that developed it; academics in other disciplines could request time on the machine to run their own programs, introducing the concept of computing as a service. EDSAC was followed by EDSAC II, and then Titan. It was only in the mid-1960s that the University stopped building its own computers from scratch and started buying them from commercial vendors. This practical emphasis is even reflected in the current name of the computer department: Cambridge doesn’t have a computer science faculty; it has a computer laboratory, the direct descendant of Wilkes’ original mathematical laboratory.

> 其中一组工程师在剑桥大学数学实验室的莫里斯·威尔克斯 (Maurice Wilkes) 的领导下着手构建电子延迟存储自动计算器 (EDSAC)。当它于 1949 年首次投入使用时，它拥有 500kHz 的时钟速度，两个温控水浴中的 32 条水银延迟线，总计 2 KB 的易失性存储空间。程序和数据可以从纸带上读取和写入。美国和英国的许多机构都可以提出狭义的声明，声称已经生产出第一台通用数字计算机，以获得 `第一` 的特定价值。有人声称 EDSAC 是第一台在开发团队之外广泛使用的计算机；其他学科的学者可以在机器上请求时间来运行他们自己的程序，引入计算即服务的概念。EDSAC 之后是 EDSAC II，然后是 Titan。直到 20 世纪 60 年代中期，大学才停止从头开始构建自己的计算机，并开始从商业供应商那里购买。这种实际的重视甚至反映在计算机系的当前名称中：剑桥没有计算机科学系；它有一个计算机实验室，是威尔克斯最初的数学实验室的直系后代。

This focus on the practical elements of computer engineering has made Cambridge fertile ground for high-technology startups, many of them spun out of the computer laboratory, the engineering department or the various maths and science faculties (even our mathematicians know how to hack), and has made it a magnet for multinational firms seeking engineering talent. Variously referred to as the Cambridge Cluster, the Cambridge Phenomenon or just Silicon Fen, the network of firms that has grown up around the University represents one of the few bona fide technology clusters outside of Silicon Valley. The BBC Microcomputer that told me I should become a chip designer was a Cambridge product, as was its perennial rival, the Sinclair Spectrum. Your cell phone (and your Raspberry Pi) contains several processors designed by the Cambridge-based chip firm ARM. Seventy years after EDSAC, Cambridge remains the home of high technology in the UK.

> 这种对计算机工程实用元素的关注使剑桥成为高科技创业公司的沃土，其中许多公司从计算机实验室、工程系或各种数学和科学学院中脱颖而出(甚至我们的数学家都知道如何破解)，并使其成为吸引寻求工程人才的跨国公司的磁石。围绕剑桥大学发展起来的公司网络被称为剑桥集群、剑桥现象或硅沼，代表了硅谷以外为数不多的真正的技术集群之一。告诉我应该成为一名芯片设计师的 BBC 微型计算机是剑桥的产品，它的长期竞争对手辛克莱光谱也是如此。您的手机(和您的 Raspberry Pi)包含多个由剑桥芯片公司 ARM 设计的处理器。在 EDSAC 成立七十年后，剑桥仍然是英国高科技的发源地。

## Cut to the Chase

One of the biggest missing pieces from my haphazard computing education was an idea of how, underneath it all, my computer worked. While I’d graduated downwards from BASIC to assembly language, I’d become `stuck` at that level of abstraction. I could poke my Amiga’s hardware registers to move sprites around the screen but I had no idea how I might go about building a computer of my own. It took me another decade, a couple of degrees and a move out of academia to work for Broadcom (a U.S. semiconductor company that came to Cambridge for the startups and stayed for the engineering talent) for me to get to the point where I woke up one morning with `microelectronic chip designer` (in fact the fancier equivalent, `ASIC architect` ) on my business card. During this time, I’ve had the privilege of working with, and learning from, a number of vastly more accomplished practitioners in the field, including Sophie Wilson, architect (with Steve Furber) of the BBC Micro and the original ARM processor, and Tim Mamtora of Broadcom’s 3D graphics hardware engineering team, who has graciously provided the chapter on graphics processing units (GPUs) for this book.

> 在我随意的计算机教育中，最大的遗漏之一是我的计算机在这一切之下是如何工作的。当我从 BASIC 向下毕业到汇编语言时，我会 `陷入` 那个抽象级别。我可以戳我的 Amiga 的硬件寄存器来在屏幕上移动精灵，但我不知道如何构建我自己的计算机。我又花了十年时间，获得了几个学位，并离开了学术界，为 Broadcom(一家美国半导体公司，为初创企业来到剑桥，为工程人才留下来)工作，直到我醒来 一天早上，我的名片上写着 `微电子芯片设计师` (实际上是更高级的 `ASIC 架构师` )。在此期间，我有幸与该领域许多更有成就的从业者一起工作并向他们学习，包括 BBC Micro 和原始 ARM 处理器的架构师 Sophie Wilson(与 Steve Furber 一起)，以及 Broadcom 的 3D 图形硬件工程团队的 Tim Mamtora，他慷慨地为本书提供了有关图形处理单元 (GPU) 的章节。

To a great degree, my goal in writing this book was to produce the `how it works` title that I wish I’d had when I was 18. We’ve attempted to cover each major component of a modern computing system, from the CPU to volatile random-access storage, persistent storage, networking and interfacing, at a level that should be accessible to an interested secondary school student or first-year undergraduate. Alongside a discussion of the current state of the art, we’ve attempted to provide a little historical context; it’s remarkable that most of the topics covered (though not, obviously, the fine technical details) would have been of relevance to Wilkes’ EDSAC engineering team in 1949. You should reach the end with at least a little understanding of the principles that underpin the operation of your computer. I firmly believe that you will find this understanding valuable even if you’re destined for a career as a software engineer and never plan to design a computer of your own. If you don’t know what a cache is, you’ll be surprised that your program’s performance drops off a cliff when your working set ends up larger than your cache, or when you align your buffers so that they exhaust the cache’s associativity. If you don’t know a little about how Ethernet works, you’ll struggle to build a performant network for your datacentre.

> 在很大程度上，我写这本书的目标是写出我希望在 18 岁时就拥有的 `它是如何工作的` 这个书名。我们试图涵盖现代计算系统的每个主要组件，从 从 CPU 到易失性随机存取存储、持久存储、网络和接口，感兴趣的中学生或一年级本科生应该可以访问的级别。除了对当前技术水平的讨论，我们还试图提供一些历史背景；值得注意的是，所涵盖的大部分主题(尽管显然不是精细的技术细节)都与 1949 年 Wilkes 的 EDSAC 工程团队相关。你应该至少对支持 EDSAC 的原理有一点理解 电脑的操作。我坚信，即使您注定要从事软件工程师的职业并且从不打算设计自己的计算机，您也会发现这种理解很有价值。如果您不知道缓存是什么，当您的工作集最终大于缓存时，或者当您对齐缓冲区以耗尽缓存的关联性时，您的程序性能会急剧下降，您会感到惊讶。如果您对以太网的工作原理知之甚少，您将难以为您的数据中心构建高性能网络。

It’s worth dwelling for a moment on what this book isn’t, and what it won’t tell you. It isn’t a comprehensive technical reference for any of the topics covered. You could write (and people have written) whole volumes on the design of caches, CPU pipelines, compilers and network stacks. Instead, we try to provide a primer for each topic, and some suggestions for further study. It is concerned primarily with the architecture of conventional general-purpose computers (in essence, PCs). There is limited coverage of topics like digital signal processing (DSP) and field-programmable gate arrays (FPGAs), which are primarily of interest in special purpose, application-specific domains. Finally, there is little coverage of the quantitative decision-making process that is the heart of good computer architecture: how do you trade off the size of your cache against access time, or decide whether to allow one subsystem coherent access to a cache that forms part of another component? We can’t teach you to think like an architect. For the advanced reader, Hennessy and Patterson’s _Computer Architecture: A Quantitative Approach_ remains an indispensable reference on this front.

> 值得花点时间仔细想想这本书不是什么，它不会告诉你什么。对于所涵盖的任何主题，它都不是全面的技术参考。你可以写(而且人们已经写过)有关缓存、CPU 管道、编译器和网络堆栈设计的整本书。相反，我们尝试为每个主题提供入门，并为进一步研究提供一些建议。它主要关注传统通用计算机(本质上是 PC)的体系结构。数字信号处理 (DSP) 和现场可编程门阵列 (FPGA) 等主题的覆盖范围有限，这些主题主要针对特殊用途的特定应用领域。最后，很少涉及作为良好计算机体系结构核心的定量决策过程：如何权衡缓存大小与访问时间，或者决定是否允许一个子系统对形成的缓存进行一致访问 另一个组件的一部分？ 我们不能教你像建筑师一样思考。对于高级读者，Hennessy 和 Patterson 的《计算机体系结构：定量方法》仍然是这方面不可或缺的参考资料。

## The Knee in the Curve

With that last disclaimer in mind, I’d like to share a couple of guiding principles that I have found useful over the years.

> 考虑到最后的免责声明，我想分享多年来我发现有用的几个指导原则。

In computer architecture, as in many things, there is a law of diminishing returns. There are, of course, hard limits to what can be accomplished at any given moment, whether in terms of raw CPU performance, CPU performance normalised to power consumption, storage density, transistor size, or network bandwidth over a medium. But it is often the case that well before we reach these theoretical limits we encounter diminishing returns to the application of engineering effort: each incremental improvement is increasingly hard won and exacts a growing toll in terms of cost and, critically, schedule. If you were to graph development effort, system complexity (and thus vulnerability to bugs) or cash spent against performance, the curve would bend sharply upward at some point. To the left of this `knee` , performance would respond in a predictable (even linear!) fashion to increasing expenditure of effort; to the right, performance would increase only slowly with added effort, asymptotically approaching the `wall` imposed by fundamental technical limitations.

> 在计算机体系结构中，与许多事物一样，存在收益递减规律。当然，在任何给定时刻可以完成的事情都有硬性限制，无论是原始 CPU 性能、标准化为功耗的 CPU 性能、存储密度、晶体管大小，还是介质上的网络带宽。但通常情况是，在我们达到这些理论极限之前，我们会遇到工程应用的回报递减：每一次渐进式改进都越来越来之不易，并且在成本和至关重要的时间安排方面造成越来越大的损失。如果您要将开发工作量、系统复杂性(以及因此易受错误影响)或花费的现金与性能进行对比，则曲线会在某个点急剧向上弯曲。在这个 `膝盖` 的左边，性能将以可预测的(甚至是线性的！)方式响应增加的努力支出；在右边，性能只会随着额外的努力而缓慢增加，逐渐接近基本技术限制强加的 `墙` 。

Sometimes there is no substitute for performance. The Apollo lunar project, for example, was an amazing example of engineering that was so far to the right of the `knee` (powered by the expenditure of several percent of the GDP of the world’s largest economy) that it fundamentally misled onlookers about the maturity of aerospace technology. It is only now—after 50 years of incremental advances in rocketry, avionics and material science—that the knee has moved far enough to permit access to space, and maybe even a return to the Moon, at reasonable cost. Nonetheless, I have observed that teams that have the humility to accurately locate the knee bring simple, conservatively engineered systems to market in a timely fashion and then iterate rapidly, tend to win over moon-shot engineering.

> 有时候性能是无可替代的。例如，阿波罗登月计划是工程的一个惊人例子，它到目前为止处于 `膝盖` 的右侧(由世界最大经济体 GDP 的百分之几的支出提供动力)，它从根本上误导了旁观者关于 航天技术的成熟度。直到现在——在火箭技术、航空电子学和材料科学取得了 50 年的渐进进步之后——膝盖已经移动得足够远，可以进入太空，甚至可能以合理的成本重返月球。尽管如此，我观察到那些谦虚地准确定位膝盖的团队会及时将简单、保守设计的系统推向市场，然后快速迭代，往往会赢得登月工程。

Conservatism and iteration are at the heart of my own approach to architecture. The three generations of Raspberry Pi chips that we’ve produced to date use _exactly_ the same system infrastructure, memory controller and multimedia, with changes confined to the ARM core complex, a small number of critical bug fixes and an increase in clock speed. There is a tension here: engineers (myself included) are enthusiasts and want to push the boundaries. The job of a good architect is to accurately assign a cost to the risks associated with radical change, and to weigh this against the purported benefits.

> 保守主义和迭代是我自己建筑方法的核心。我们迄今为止生产的三代 Raspberry PI 芯片使用*ESACTLY *相同的系统基础架构，内存控制器和多媒体，并且更改局限于 ARM Corce 复合物，少量的关键错误修复和时钟速度的增加。这里有一个紧张局势：工程师(包括我自己)是爱好者，想突破界限。优秀的建筑师的工作是准确地分配与根本变化相关的风险，并权衡所谓的收益。

## Forward the Foundation

We founded the Raspberry Pi Foundation in 2008, initially with the simple aim of addressing a collapse in the number of students applying to study Computer Science at Cambridge. We’re seeing encouraging signs of recovery, both at Cambridge and elsewhere, and applicant numbers are now higher than they were at the height of the dotcom boom in the late 1990s.

> 我们于 2008 年创立了 Raspberry Pi 基金会，最初是为了解决申请在剑桥学习计算机科学的学生人数崩溃的简单目的。在剑桥和其他地方，我们看到令人鼓舞的恢复迹象，现在申请人的数字比 1990 年代后期的 Dotcom Boom 的高峰高。

Perhaps the most striking aspect of the change we’ve witnessed is that the new generation of young people is far more interested in hardware than we were in the 1980s. Writing an assembly language routine to move a sprite around on the screen clearly isn’t quite as much fun as it used to be, but moving a robot around the floor is much more exciting. We see 12-year-olds today building control and sensing projects that I would have been proud of in my mid-20s. My hope is that when some of these young people sit down in front of the distant descendants of the BBC Micro careers program of my childhood, some of them will be told that they’d make great microelectronic chip designers, and that this book might help one or two of them make that journey.

> 也许我们目睹的变化最引人注目的方面是，新一代的年轻人对硬件的兴趣要比 1980 年代更感兴趣。编写一个汇编语言程序来显然在屏幕上移动精灵并不像以前那样有趣，但是在地板上移动机器人会更加令人兴奋。我们看到今天有 12 岁的孩子建立了控制和感知项目，这是我 20 多岁时会为之骄傲的。我的希望是，当其中一些年轻人坐在我童年时代 BBC 微型职业计划的遥远后代前，他们中有些人会被告知他们会成为出色的微电子芯片设计师，这本书可能会帮助您他们中的一两个旅行。

—Eben Upton, Cambridge, May 2016
